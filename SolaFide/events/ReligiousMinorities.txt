namespace = sola_fide

# The goal with the religious minorities mechanic is as follows:
# 	1. When converting a province, there is a chance to trigger the entrenchment of that religion (event)
#	2. When conversion finishes (or is triggered as the result of another event or action), then the entrenched religion becomes a religiious minority (on_action)
# 	3. The minority is cleared if a) they are expelled (another mechanic), b) supressed (another mechanic), or c) they become the majority religion again

# MTTH trigger on provinces undergoing conversion. This sets up the entrenched religion,
# which will later be converted to the minority province attribute via on_action
province_event = {

	id = sola_fide.1
	title = "sola_fide_religion_entrenched_title"
	desc = "sola_fide_religion_entrenched_desc"
	picture = "RELIGION_eventPicture"

	mean_time_to_happen = {
		months = 1
	}

	trigger = {
		has_construction = missionary
		OR = {
 			AND = {
					religion = catholic
					NOT = { has_province_modifier = sola_fide.religion_entrenched.catholic }
			}
 			AND = {
					religion = protestant
					NOT = { has_province_modifier = sola_fide.religion_entrenched.protestant }
			}
 			AND = {
					religion = reformed
					NOT = { has_province_modifier = sola_fide.religion_entrenched.reformed }
			}
 			AND = {
					religion = anglican
					NOT = { has_province_modifier = sola_fide.religion_entrenched.anglican }
			}
 			AND = {
					religion = orthodox
					NOT = { has_province_modifier = sola_fide.religion_entrenched.orthodox }
			}
 			AND = {
					religion = coptic
					NOT = { has_province_modifier = sola_fide.religion_entrenched.coptic }
			}
 			AND = {
					religion = hussite
					NOT = { has_province_modifier = sola_fide.religion_entrenched.hussite }
			}
 			AND = {
					religion = lollard
					NOT = { has_province_modifier = sola_fide.religion_entrenched.lollard }
			}
 			AND = {
					religion = anabaptist
					NOT = { has_province_modifier = sola_fide.religion_entrenched.anabaptist }
			}
 			AND = {
					religion = waldensian
					NOT = { has_province_modifier = sola_fide.religion_entrenched.waldensian }
			}
 			AND = {
					religion = dissenter
					NOT = { has_province_modifier = sola_fide.religion_entrenched.dissenter }
			}
 			AND = {
					religion = jewish
					NOT = { has_province_modifier = sola_fide.religion_entrenched.jewish }
			}
 			AND = {
					religion = karaite
					NOT = { has_province_modifier = sola_fide.religion_entrenched.karaite }
			}
 			AND = {
					religion = samaritan
					NOT = { has_province_modifier = sola_fide.religion_entrenched.samaritan }
			}
 			AND = {
					religion = sunni
					NOT = { has_province_modifier = sola_fide.religion_entrenched.sunni }
			}
 			AND = {
					religion = shiite
					NOT = { has_province_modifier = sola_fide.religion_entrenched.shiite }
			}
 			AND = {
					religion = ibadi
					NOT = { has_province_modifier = sola_fide.religion_entrenched.ibadi }
			}
 			AND = {
					religion = buddhism
					NOT = { has_province_modifier = sola_fide.religion_entrenched.buddhism }
			}
 			AND = {
					religion = vajrayana
					NOT = { has_province_modifier = sola_fide.religion_entrenched.vajrayana }
			}
 			AND = {
					religion = mahayana
					NOT = { has_province_modifier = sola_fide.religion_entrenched.mahayana }
			}
 			AND = {
					religion = confucianism
					NOT = { has_province_modifier = sola_fide.religion_entrenched.confucianism }
			}
 			AND = {
					religion = shinto
					NOT = { has_province_modifier = sola_fide.religion_entrenched.shinto }
			}
 			AND = {
					religion = hinduism
					NOT = { has_province_modifier = sola_fide.religion_entrenched.hinduism }
			}
 			AND = {
					religion = sikhism
					NOT = { has_province_modifier = sola_fide.religion_entrenched.sikhism }
			}
 			AND = {
					religion = animism
					NOT = { has_province_modifier = sola_fide.religion_entrenched.animism }
			}
 			AND = {
					religion = shamanism
					NOT = { has_province_modifier = sola_fide.religion_entrenched.shamanism }
			}
 			AND = {
					religion = totemism
					NOT = { has_province_modifier = sola_fide.religion_entrenched.totemism }
			}
 			AND = {
					religion = inti
					NOT = { has_province_modifier = sola_fide.religion_entrenched.inti }
			}
 			AND = {
					religion = nahuatl
					NOT = { has_province_modifier = sola_fide.religion_entrenched.nahuatl }
			}
 			AND = {
					religion = mesoamerican_religion
					NOT = { has_province_modifier = sola_fide.religion_entrenched.mesoamerican_religion }
			}
 			AND = {
					religion = norse_pagan_reformed
					NOT = { has_province_modifier = sola_fide.religion_entrenched.norse_pagan_reformed }
			}
 			AND = {
					religion = baltic_pagan
					NOT = { has_province_modifier = sola_fide.religion_entrenched.baltic_pagan }
			}
 			AND = {
					religion = tengri_pagan_reformed
					NOT = { has_province_modifier = sola_fide.religion_entrenched.tengri_pagan_reformed }
			}
 			AND = {
					religion = zoroastrian
					NOT = { has_province_modifier = sola_fide.religion_entrenched.zoroastrian }
			}
 			AND = {
					religion = dreamtime
					NOT = { has_province_modifier = sola_fide.religion_entrenched.dreamtime }
			}

		}
	}

	immediate = {
		if = {
				limit = {
						religion = catholic
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.catholic
						duration = -1
				}
		}
		if = {
				limit = {
						religion = protestant
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.protestant
						duration = -1
				}
		}
		if = {
				limit = {
						religion = reformed
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.reformed
						duration = -1
				}
		}
		if = {
				limit = {
						religion = anglican
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.anglican
						duration = -1
				}
		}
		if = {
				limit = {
						religion = orthodox
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.orthodox
						duration = -1
				}
		}
		if = {
				limit = {
						religion = coptic
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.coptic
						duration = -1
				}
		}
		if = {
				limit = {
						religion = hussite
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.hussite
						duration = -1
				}
		}
		if = {
				limit = {
						religion = lollard
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.lollard
						duration = -1
				}
		}
		if = {
				limit = {
						religion = anabaptist
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.anabaptist
						duration = -1
				}
		}
		if = {
				limit = {
						religion = waldensian
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.waldensian
						duration = -1
				}
		}
		if = {
				limit = {
						religion = dissenter
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.dissenter
						duration = -1
				}
		}
		if = {
				limit = {
						religion = jewish
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.jewish
						duration = -1
				}
		}
		if = {
				limit = {
						religion = karaite
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.karaite
						duration = -1
				}
		}
		if = {
				limit = {
						religion = samaritan
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.samaritan
						duration = -1
				}
		}
		if = {
				limit = {
						religion = sunni
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.sunni
						duration = -1
				}
		}
		if = {
				limit = {
						religion = shiite
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.shiite
						duration = -1
				}
		}
		if = {
				limit = {
						religion = ibadi
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.ibadi
						duration = -1
				}
		}
		if = {
				limit = {
						religion = buddhism
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.buddhism
						duration = -1
				}
		}
		if = {
				limit = {
						religion = vajrayana
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.vajrayana
						duration = -1
				}
		}
		if = {
				limit = {
						religion = mahayana
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.mahayana
						duration = -1
				}
		}
		if = {
				limit = {
						religion = confucianism
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.confucianism
						duration = -1
				}
		}
		if = {
				limit = {
						religion = shinto
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.shinto
						duration = -1
				}
		}
		if = {
				limit = {
						religion = hinduism
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.hinduism
						duration = -1
				}
		}
		if = {
				limit = {
						religion = sikhism
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.sikhism
						duration = -1
				}
		}
		if = {
				limit = {
						religion = animism
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.animism
						duration = -1
				}
		}
		if = {
				limit = {
						religion = shamanism
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.shamanism
						duration = -1
				}
		}
		if = {
				limit = {
						religion = totemism
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.totemism
						duration = -1
				}
		}
		if = {
				limit = {
						religion = inti
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.inti
						duration = -1
				}
		}
		if = {
				limit = {
						religion = nahuatl
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.nahuatl
						duration = -1
				}
		}
		if = {
				limit = {
						religion = mesoamerican_religion
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.mesoamerican_religion
						duration = -1
				}
		}
		if = {
				limit = {
						religion = norse_pagan_reformed
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.norse_pagan_reformed
						duration = -1
				}
		}
		if = {
				limit = {
						religion = baltic_pagan
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.baltic_pagan
						duration = -1
				}
		}
		if = {
				limit = {
						religion = tengri_pagan_reformed
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.tengri_pagan_reformed
						duration = -1
				}
		}
		if = {
				limit = {
						religion = zoroastrian
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.zoroastrian
						duration = -1
				}
		}
		if = {
				limit = {
						religion = dreamtime
				}
				add_province_modifier = {
						name = sola_fide.religion_entrenched.dreamtime
						duration = -1
				}
		}

	}

	option = {
		name = "SOLA_FIDE_RELIGION_ENTRENCHED_ACCEPT"
	}
}

namespace = sola_fide_debug

# This is strictly for debugging, to quickly visualize which provinces have what religious minority.
# (Won't help if a provice has more than one minority, which is certainly possible, but has been added mostly
# to help with game setup.)
#
# To run, execute on the console:
# 	event sola_fide_debug.1
#
province_event = {
	
	id = sola_fide_debug.1
	title = "sola_fide_debug_convert_all_minortiy_provinces_title"
	desc = "sola_fide_debug_convert_all_minortiy_provinces_desc"
	picture = "RELIGION_eventPicture"

	is_triggered_only = yes
	hidden = yes

	trigger = {}

	immediate = {
		hidden_effect = {
			every_province = {
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.catholic
						}
						change_religion = catholic
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.protestant
						}
						change_religion = protestant
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.reformed
						}
						change_religion = reformed
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.anglican
						}
						change_religion = anglican
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.orthodox
						}
						change_religion = orthodox
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.coptic
						}
						change_religion = coptic
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.hussite
						}
						change_religion = hussite
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.lollard
						}
						change_religion = lollard
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.anabaptist
						}
						change_religion = anabaptist
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.waldensian
						}
						change_religion = waldensian
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.dissenter
						}
						change_religion = dissenter
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.jewish
						}
						change_religion = jewish
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.karaite
						}
						change_religion = karaite
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.samaritan
						}
						change_religion = samaritan
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.sunni
						}
						change_religion = sunni
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.shiite
						}
						change_religion = shiite
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.ibadi
						}
						change_religion = ibadi
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.buddhism
						}
						change_religion = buddhism
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.vajrayana
						}
						change_religion = vajrayana
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.mahayana
						}
						change_religion = mahayana
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.confucianism
						}
						change_religion = confucianism
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.shinto
						}
						change_religion = shinto
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.hinduism
						}
						change_religion = hinduism
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.sikhism
						}
						change_religion = sikhism
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.animism
						}
						change_religion = animism
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.shamanism
						}
						change_religion = shamanism
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.totemism
						}
						change_religion = totemism
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.inti
						}
						change_religion = inti
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.nahuatl
						}
						change_religion = nahuatl
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.mesoamerican_religion
						}
						change_religion = mesoamerican_religion
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.norse_pagan_reformed
						}
						change_religion = norse_pagan_reformed
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.baltic_pagan
						}
						change_religion = baltic_pagan
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.tengri_pagan_reformed
						}
						change_religion = tengri_pagan_reformed
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.zoroastrian
						}
						change_religion = zoroastrian
					}
					if = {
						limit = {
							has_province_modifier = sola_fide.religious_minority.dreamtime
						}
						change_religion = dreamtime
					}
			}
		}
	}

	option = {
		name = "SOLA_FIDE_RELIGION_ENTRENCHED_ACCEPT"
	}
}